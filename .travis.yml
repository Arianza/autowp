sudo: required
language: generic
services:
  - docker
before_install:
  - docker pull autowp/autowp
  - docker build -t autowp/autowp .
  - docker-compose up -d module/Application/test/_files/docker-compose.yml
  - docker exec autowp_test_mysql "mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root mysql"
  - docker exec autowp_test_mysql "mysql -u root -p password -e 'create database autowp_test;'"
  - docker exec autowp_test_mysql "mysql -u root -p password < module/Application/test/_files/dump.sql"
  - docker exec autowp_test_mysql "mysql -u root -p password -e 'GRANT ALL PRIVILEGES ON autowp_test.* TO autowp_test@localhost IDENTIFIED BY "test";'"
  
script: docker exec autowp_test_web vendor/bin/phpunit

after_script:
- docker exec autowp_test_web "./vendor/bin/coveralls -v"
- docker exec autowp_test_web "./vendor/bin/test-reporter -v --coverage-report=./logs/clover.xml"
